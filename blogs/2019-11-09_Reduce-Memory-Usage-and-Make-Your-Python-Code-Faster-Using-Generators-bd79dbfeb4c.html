<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Reduce Memory Usage and Make Your Python Code Faster Using Generators</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Reduce Memory Usage and Make Your Python Code Faster Using Generators</h1>
</header>
<section data-field="subtitle" class="p-summary">
A hands on guide to create iterators in a very pythonic manner
</section>
<section data-field="body" class="e-content">
<section name="f2c4" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--fullWidth"><figure name="506c" id="506c" class="graf graf--figure graf--layoutFillWidth graf--leading"><img class="graf-image" data-image-id="1*6n-OewGxbpADA7U1oPkE1Q.jpeg" data-width="4048" data-height="2277" src="https://cdn-images-1.medium.com/max/2560/1*6n-OewGxbpADA7U1oPkE1Q.jpeg"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@thomasreaubourg?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/@thomasreaubourg?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Thomas Reaubourg</a> on <a href="https://unsplash.com/s/photos/wind-turbine?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/s/photos/wind-turbine?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Unsplash</a></figcaption></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="1291" id="1291" class="graf graf--h3 graf-after--figure graf--title">Reduce Memory Usage and Make Your Python Code Faster Using Generators</h3><h4 name="96bb" id="96bb" class="graf graf--h4 graf-after--h3 graf--subtitle">A hands on guide to create iterators in a very pythonic manner</h4><p name="2a83" id="2a83" class="graf graf--p graf-after--h4 graf--trailing">Stuck behind the paywall? Click <a href="https://medium.com/p/reduce-memory-usage-and-make-your-python-code-faster-using-generators-bd79dbfeb4c?source=email-c3f5233f3441--writer.postDistributed&amp;sk=0df12326edf2c4ec27df874c7d864b50" data-href="https://medium.com/p/reduce-memory-usage-and-make-your-python-code-faster-using-generators-bd79dbfeb4c?source=email-c3f5233f3441--writer.postDistributed&amp;sk=0df12326edf2c4ec27df874c7d864b50" class="markup--anchor markup--p-anchor" target="_blank">here</a> to read the full story with my Friend Link!</p></div></div></section><section name="3575" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="2c92" id="2c92" class="graf graf--p graf--leading">When I started learning about python generators, I had no idea how important it would turn out to be. It has helped me immensely while writing custom functions throughout my machine learning journey.</p><p name="24ed" id="24ed" class="graf graf--p graf-after--p">Generator functions allow you to declare a function that behaves like an iterator. They allow programmers to make an iterator in a fast, easy, and clean way. An iterator is an object that can be iterated (looped) upon. It is used to abstract a container of data to make it behave like an iterable object. Some examples of common iterable objects are strings, lists and dictionaries.</p><p name="ecc6" id="ecc6" class="graf graf--p graf-after--p">A generator looks a lot like a function, but uses the keyword <code class="markup--code markup--p-code">yield</code>instead of <code class="markup--code markup--p-code">return</code>. Let us take an example for better understanding.</p><pre name="26e3" id="26e3" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">def</code> <code class="markup--code markup--pre-code">generate_numbers():</code><br>    <code class="markup--code markup--pre-code">n</code> <code class="markup--code markup--pre-code">=</code> <code class="markup--code markup--pre-code">0</code><br>    <code class="markup--code markup--pre-code">while</code> <code class="markup--code markup--pre-code">n</code> <code class="markup--code markup--pre-code">&lt;</code> 3<code class="markup--code markup--pre-code">:</code><br>        <code class="markup--code markup--pre-code">yield</code> <code class="markup--code markup--pre-code">n</code><br>        <code class="markup--code markup--pre-code">n</code> <code class="markup--code markup--pre-code">+=</code> <code class="markup--code markup--pre-code">1</code></pre><p name="47f0" id="47f0" class="graf graf--p graf-after--pre">That’s a generator function. When you call it, it returns a generator object:</p><pre name="c57a" id="c57a" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">&gt;&gt;&gt;</code> <code class="markup--code markup--pre-code">numbers</code> <code class="markup--code markup--pre-code">=</code> <code class="markup--code markup--pre-code">generate_numbers()</code><br><code class="markup--code markup--pre-code">&gt;&gt;&gt;</code> <code class="markup--code markup--pre-code">type(numbers)</code><br><code class="markup--code markup--pre-code">&lt;class</code> <code class="markup--code markup--pre-code">&#39;generator&#39;&gt;</code></pre><p name="611e" id="611e" class="graf graf--p graf-after--pre">The important thing to note is how state is encapsulated within the body of the generator function. You can also step through one by one, using the built-in <code class="markup--code markup--p-code">next()</code> function:</p><pre name="8567" id="8567" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">&gt;&gt;&gt;</code> next<code class="markup--code markup--pre-code">_number</code> <code class="markup--code markup--pre-code">=</code> <code class="markup--code markup--pre-code">generate_numbers()</code><br><code class="markup--code markup--pre-code">&gt;&gt;&gt;</code> <code class="markup--code markup--pre-code">next(</code>next<code class="markup--code markup--pre-code">_number)</code><br><code class="markup--code markup--pre-code">0</code><br><code class="markup--code markup--pre-code">&gt;&gt;&gt;</code> <code class="markup--code markup--pre-code">next(</code>next<code class="markup--code markup--pre-code">_number)</code><br><code class="markup--code markup--pre-code">1</code><br><code class="markup--code markup--pre-code">&gt;&gt;&gt;</code> <code class="markup--code markup--pre-code">next(</code>next<code class="markup--code markup--pre-code">_number)</code><br><code class="markup--code markup--pre-code">2</code></pre><h3 name="e22b" id="e22b" class="graf graf--h3 graf-after--pre">What happens if you call <code class="markup--code markup--h3-code">next()</code> past the end?</h3><p name="24ea" id="24ea" class="graf graf--p graf-after--h3"><code class="markup--code markup--p-code">StopIteration</code> is a built-in exception type, which is automatically raised once the generator stops yielding. It&#39;s the signal to the for loop to stop.</p><h3 name="b066" id="b066" class="graf graf--h3 graf-after--p">Yield Statement</h3><p name="9a3a" id="9a3a" class="graf graf--p graf-after--h3">Its primary job is to control the flow of a generator function in a way that’s similar to <code class="markup--code markup--p-code">return</code> statement. When you call a generator function or use a generator expression, you return a special iterator called a generator. You can assign this generator to a variable in order to use it. When you call special methods on the generator, such as <code class="markup--code markup--p-code">next()</code>, the code within the function is executed up to <code class="markup--code markup--p-code">yield</code>.</p><p name="8417" id="8417" class="graf graf--p graf-after--p graf--trailing">When the Python yield statement is hit, the program suspends function execution and returns the yielded value to the caller. (In contrast, <code class="markup--code markup--p-code">return</code> stops function execution completely.) When a function is suspended, the state of that function is saved.</p></div></div></section><section name="5a2c" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="3347" id="3347" class="graf graf--p graf--leading">Now that we are familiar with python generator, let us compare the normal approach vs using generators with regards to memory usage and time taken for the code to execute.</p><h3 name="8580" id="8580" class="graf graf--h3 graf-after--p">The Problem Statement</h3><p name="5ea0" id="5ea0" class="graf graf--p graf-after--h3">Let us say that we have to iterate through a large list of numbers (eg 100000000) and store the square of all the numbers which are even in a seperate list.</p><h3 name="5875" id="5875" class="graf graf--h3 graf-after--p">The Normal Approach</h3><pre name="9f92" id="9f92" class="graf graf--pre graf-after--h3">import memory_profiler<br>import time<br>def check_even(numbers):<br>    even = []<br>    for num in numbers:<br>        if num % 2 == 0: <br>            even.append(num*num)<br>            <br>    return even</pre><pre name="d7af" id="d7af" class="graf graf--pre graf-after--pre">if __name__ == &#39;__main__&#39;:<br>    m1 = memory_profiler.memory_usage()<br>    t1 = time.clock()<br>    cubes = check_even(range(100000000))<br>    t2 = time.clock()<br>    m2 = memory_profiler.memory_usage()<br>    time_diff = t2 - t1<br>    mem_diff = m2[0] - m1[0]<br>    print(f&quot;It took {time_diff} Secs and {mem_diff} Mb to execute this method&quot;)</pre><p name="655b" id="655b" class="graf graf--p graf-after--pre">On running, we get the output of the above code as.</p><pre name="6f04" id="6f04" class="graf graf--pre graf-after--p">It took 21.876470000000005 Secs and 1929.703125 Mb to execute this method</pre><h3 name="ef68" id="ef68" class="graf graf--h3 graf-after--pre">Using Generators</h3><pre name="845a" id="845a" class="graf graf--pre graf-after--h3">import memory_profiler<br>import time<br>def check_even(numbers):<br>    for num in numbers:<br>        if num % 2 == 0:<br>            yield num * num <br>    <br>if __name__ == &#39;__main__&#39;:<br>    m1 = memory_profiler.memory_usage()<br>    t1 = time.clock()<br>    cubes = check_even(range(100000000))<br>    t2 = time.clock()<br>    m2 = memory_profiler.memory_usage()<br>    time_diff = t2 - t1<br>    mem_diff = m2[0] - m1[0]<br>    print(f&quot;It took {time_diff} Secs and {mem_diff} Mb to execute this method&quot;)</pre><p name="a83b" id="a83b" class="graf graf--p graf-after--pre">On running, we get the output of the above code as.</p><pre name="a62d" id="a62d" class="graf graf--pre graf-after--p">It took 2.9999999995311555e-05 Secs and 0.02656277 Mb to execute this method</pre><figure name="18fc" id="18fc" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*8xC0khI4StoWcJSSuLKERg.png" data-width="959" data-height="234" src="https://cdn-images-1.medium.com/max/800/1*8xC0khI4StoWcJSSuLKERg.png"></figure><p name="e236" id="e236" class="graf graf--p graf-after--figure">As we can see both the time taken to execute and memory usage has been reduced drastically. Generators only work on demand which is famously known as working by lazy evaluation. That means that they can save cpu, memory and other computational resources.</p><h3 name="a1a1" id="a1a1" class="graf graf--h3 graf-after--p">Conclusions</h3><p name="4a57" id="4a57" class="graf graf--p graf-after--h3">As a quick recap, I showed how python generators can be used to reduce memory usage and make the code execute faster. The advantage lies in the fact that generators don’t store all results in memory, rather they generate them on the fly, hence the memory is only used when we ask for the result. Also generators abstract away much of the boilerplate code needed when writing iterators, hence also helps in reducing the size of code.</p><h3 name="28e2" id="28e2" class="graf graf--h3 graf-after--p">References/Further Readings</h3><div name="138a" id="138a" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://stackabuse.com/python-generators/" data-href="https://stackabuse.com/python-generators/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://stackabuse.com/python-generators/"><strong class="markup--strong markup--mixtapeEmbed-strong">Python Generators</strong><br><em class="markup--em markup--mixtapeEmbed-em">What is a Generator? A Python generator is a function that produces a sequence of results. It works by maintaining its…</em>stackabuse.com</a><a href="https://stackabuse.com/python-generators/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="c27e191c363cdb20e99a102a81b6c90d" data-thumbnail-img-id="0*LL6wSFzLW0561XtF" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*LL6wSFzLW0561XtF);"></a></div><div name="b5d0" id="b5d0" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://www.dataquest.io/blog/python-generators-tutorial/" data-href="https://www.dataquest.io/blog/python-generators-tutorial/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.dataquest.io/blog/python-generators-tutorial/"><strong class="markup--strong markup--mixtapeEmbed-strong">Python Generators - Dataquest</strong><br><em class="markup--em markup--mixtapeEmbed-em">Python generators are a powerful, but misunderstood tool. They&#39;re often treated as too difficult a concept for…</em>www.dataquest.io</a><a href="https://www.dataquest.io/blog/python-generators-tutorial/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="3062c3d9b84b95782fa385df7b8f1134" data-thumbnail-img-id="0*eGSA5pUXhcp-be3Z" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*eGSA5pUXhcp-be3Z);"></a></div><h3 name="ee5b" id="ee5b" class="graf graf--h3 graf-after--mixtapeEmbed">Contacts</h3><p name="0c5a" id="0c5a" class="graf graf--p graf-after--h3">If you want to keep updated with my latest articles and projects <a href="https://medium.com/@abhinav.sagar" data-href="https://medium.com/@abhinav.sagar" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">follow me on Medium</a>. These are some of my contacts details:</p><ul class="postList"><li name="4869" id="4869" class="graf graf--li graf-after--p"><a href="https://in.linkedin.com/in/abhinavsagar4" data-href="https://in.linkedin.com/in/abhinavsagar4" class="markup--anchor markup--li-anchor" rel="noopener nofollow noopener" target="_blank">Linkedin</a></li><li name="dae1" id="dae1" class="graf graf--li graf-after--li"><a href="https://medium.com/@abhinav.sagar" data-href="https://medium.com/@abhinav.sagar" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Medium Profile</a></li><li name="168c" id="168c" class="graf graf--li graf-after--li"><a href="https://github.com/abhinavsagar" data-href="https://github.com/abhinavsagar" class="markup--anchor markup--li-anchor" rel="noopener nofollow noopener" target="_blank">GitHub</a></li><li name="a315" id="a315" class="graf graf--li graf-after--li"><a href="https://www.kaggle.com/abhinavsagar" data-href="https://www.kaggle.com/abhinavsagar" class="markup--anchor markup--li-anchor" rel="noopener nofollow noopener" target="_blank">Kaggle</a></li><li name="d566" id="d566" class="graf graf--li graf-after--li"><a href="https://abhinavsagar.github.io/" data-href="https://abhinavsagar.github.io/" class="markup--anchor markup--li-anchor" rel="noopener nofollow noopener" target="_blank">Personal Website</a></li></ul><p name="d753" id="d753" class="graf graf--p graf-after--li graf--trailing">Happy reading, happy learning and happy coding!</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@abhinav.sagar" class="p-author h-card">Abhinav Sagar</a> on <a href="https://medium.com/p/bd79dbfeb4c"><time class="dt-published" datetime="2019-11-09T13:44:58.052Z">November 9, 2019</time></a>.</p><p><a href="https://medium.com/@abhinav.sagar/reduce-memory-usage-and-make-your-python-code-faster-using-generators-bd79dbfeb4c" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 28, 2021.</p></footer></article></body></html>