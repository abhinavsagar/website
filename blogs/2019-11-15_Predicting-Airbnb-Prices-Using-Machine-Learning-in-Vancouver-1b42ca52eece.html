<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Predicting Airbnb Prices Using Machine Learning in Vancouver</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Predicting Airbnb Prices Using Machine Learning in Vancouver</h1>
</header>
<section data-field="subtitle" class="p-summary">
A complete machine learning project walk-through using Light GBM in python
</section>
<section data-field="body" class="e-content">
<section name="0a2f" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--fullWidth"><figure name="3999" id="3999" class="graf graf--figure graf--layoutFillWidth graf--leading"><img class="graf-image" data-image-id="1*tifFBIZ1x70MEM8swu9Aiw.jpeg" data-width="4032" data-height="2706" src="https://cdn-images-1.medium.com/max/2560/1*tifFBIZ1x70MEM8swu9Aiw.jpeg"></figure></div><div class="section-inner sectionLayout--insetColumn"><h3 name="fa2c" id="fa2c" class="graf graf--h3 graf-after--figure graf--title">Predicting Airbnb Prices Using Machine Learning in Vancouver</h3><h4 name="e57e" id="e57e" class="graf graf--h4 graf-after--h3 graf--subtitle">A complete machine learning project walk-through using Light GBM in python</h4><p name="42f3" id="42f3" class="graf graf--p graf-after--h4">Stuck behind the paywall? Click <a href="https://medium.com/p/predicting-airbnb-prices-using-machine-learning-in-vancouver-1b42ca52eece?source=email-c3f5233f3441--writer.postDistributed&amp;sk=edd2c8bea13ba57900ab877abd0f6da8" data-href="https://medium.com/p/predicting-airbnb-prices-using-machine-learning-in-vancouver-1b42ca52eece?source=email-c3f5233f3441--writer.postDistributed&amp;sk=edd2c8bea13ba57900ab877abd0f6da8" class="markup--anchor markup--p-anchor" target="_blank">here</a> to read the full story with my Friend Link!</p><blockquote name="60a7" id="60a7" class="graf graf--pullquote graf-after--p">Vancouver is the greatest city on Earth</blockquote><p name="cd53" id="cd53" class="graf graf--p graf-after--pullquote">Vancouver witnessed its biggest ever year for tourism in 2018, with a record 12 million overnight stays — an increase of 3.3 per cent from 2017.</p><p name="0bad" id="0bad" class="graf graf--p graf-after--p">Pricing a rental property on Airbnb is a challenging task for the owner as it determines the number of customers for the place. On the other hand, customers have to evaluate an offered price with minimal knowledge of an optimal value for the property. One challenge that Airbnb hosts face is determining the optimal rent price. Renters are presented with a good selection of listings and can filter by criteria like price, number of bedrooms, room type, and more. Since Airbnb is a marketplace, the amount a host can charge on a nightly basis is closely linked to the dynamics of the marketplace.</p><h3 name="2a40" id="2a40" class="graf graf--h3 graf-after--p">The Challenge</h3><p name="f786" id="f786" class="graf graf--p graf-after--h3">To make a regression model to predict the prices of the house in Vancouver using various features present in the dataset.</p><h3 name="5f5e" id="5f5e" class="graf graf--h3 graf-after--p">Business Questions to Be Answered</h3><p name="fa55" id="fa55" class="graf graf--p graf-after--h3">Q1. Which months are busiest and idlest to visit Vancouver?</p><p name="ba12" id="ba12" class="graf graf--p graf-after--p">Q2. Which months are most expensive and least expensive to visit Vancouver?</p><p name="9e37" id="9e37" class="graf graf--p graf-after--p">Q3. Which days of week are most busy and least busy to visit Vancouver?</p><p name="8a33" id="8a33" class="graf graf--p graf-after--p">Q4. Which days of week are most expensive and least expensive to visit Vancouver?</p><p name="e83b" id="e83b" class="graf graf--p graf-after--p">Q5. Which neighborhoods has the most and the least expensive listings?</p><p name="0ed0" id="0ed0" class="graf graf--p graf-after--p">Q6. How does the average price of the houses compare with the number of reviews received?</p><h3 name="4663" id="4663" class="graf graf--h3 graf-after--p">Data</h3><p name="0a80" id="0a80" class="graf graf--p graf-after--h3">The dataset can be downloaded from the Airbnb website which can be found <a href="http://insideairbnb.com/get-the-data.html" data-href="http://insideairbnb.com/get-the-data.html" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>.</p><p name="6d2c" id="6d2c" class="graf graf--p graf-after--p">I followed the general machine learning workflow step-by-step:</p><ol class="postList"><li name="687f" id="687f" class="graf graf--li graf-after--p">Data cleaning and formatting.</li><li name="fb6c" id="fb6c" class="graf graf--li graf-after--li">Exploratory data analysis.</li><li name="21d5" id="21d5" class="graf graf--li graf-after--li">Feature engineering and feature selection.</li><li name="08bd" id="08bd" class="graf graf--li graf-after--li">Evaluate the best model on the testing set.</li><li name="caa4" id="caa4" class="graf graf--li graf-after--li graf--trailing">Interpret the model results.</li></ol></div></div></section><section name="21ea" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="b665" id="b665" class="graf graf--h3 graf--leading">Where is the code?</h3><p name="2531" id="2531" class="graf graf--p graf-after--h3">Without much ado, let’s get started with the code. The complete project on github can be found <a href="https://github.com/abhinavsagar/Airbnb-in-Vancouver" data-href="https://github.com/abhinavsagar/Airbnb-in-Vancouver" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>.</p><p name="1b4f" id="1b4f" class="graf graf--p graf-after--p">I started with loading all the libraries and dependencies required.</p><pre name="bbd5" id="bbd5" class="graf graf--pre graf-after--p">import pandas as pd<br>import numpy as np<br>import matplotlib.pyplot as plt<br>import seaborn as sns<br>import matplotlib.style as style<br>import folium<br>from folium.plugins import FloatImage<br>from sklearn.preprocessing import MinMaxScaler<br>from sklearn.model_selection import train_test_split<br>from lightgbm import LGBMRegressor<br>from sklearn.metrics import r2_score<br>import warnings<br>%matplotlib inline<br>warnings.filterwarnings(&quot;ignore&quot;)<br>pd.set_option(&#39;display.max_columns&#39;, 100)</pre><p name="e8fd" id="e8fd" class="graf graf--p graf-after--pre">Let’s see how the dataset looks like.</p><p name="b2d4" id="b2d4" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">read_csv</strong> is a pandas function to read csv files and do operations on it later.</p><pre name="6c12" id="6c12" class="graf graf--pre graf-after--p">listings = pd.read_csv(&#39;../input/airbnb/listings.csv&#39;)<br>calendar = pd.read_csv(&#39;../input/airbnb/calendar.csv&#39;)<br>reviews = pd.read_csv(&#39;../input/airbnb/reviews.csv&#39;)</pre><p name="8499" id="8499" class="graf graf--p graf-after--pre"><strong class="markup--strong markup--p-strong">head()</strong> method is used to return top n (5 by default) rows of a DataFrame.</p><pre name="dc2d" id="dc2d" class="graf graf--pre graf-after--p">calendar.head(5)</pre><figure name="0417" id="0417" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*HrtdHP11eE7mAdvQXpi4Zg.png" data-width="935" data-height="263" src="https://cdn-images-1.medium.com/max/800/1*HrtdHP11eE7mAdvQXpi4Zg.png"></figure><pre name="b4c1" id="b4c1" class="graf graf--pre graf-after--figure">listings.head(1)</pre><figure name="3235" id="3235" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*ahdDc6NYJ_tkngKmBP1KLg.png" data-width="1196" data-height="296" src="https://cdn-images-1.medium.com/max/800/1*ahdDc6NYJ_tkngKmBP1KLg.png"></figure><pre name="0bc1" id="0bc1" class="graf graf--pre graf-after--figure">reviews.head(5)</pre><figure name="77ed" id="77ed" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*NXGgcoDH4o0HX5KSlkhKfg.png" src="https://cdn-images-1.medium.com/max/800/1*NXGgcoDH4o0HX5KSlkhKfg.png"></figure><h3 name="ff38" id="ff38" class="graf graf--h3 graf-after--figure">1. Data Cleaning and Formatting</h3><p name="e9b0" id="e9b0" class="graf graf--p graf-after--h3">I did some data cleaning like making an additional column available which takes value as 1 if the house is occupied while 0 otherwise. Also I converted the date to datetime format and removed the dollar sign from the price feature.</p><pre name="eeb1" id="eeb1" class="graf graf--pre graf-after--p">calendar[&#39;available&#39;] = calendar.available.map(<strong class="markup--strong markup--pre-strong">lambda</strong> x: 1 <strong class="markup--strong markup--pre-strong">if</strong> x == &#39;t&#39; <strong class="markup--strong markup--pre-strong">else</strong> 0)<br>calendar.date = pd.to_datetime(calendar.date)<br>calendar[&#39;price&#39;] = calendar[&#39;price&#39;].str.replace(&#39;$&#39;, &#39;&#39;).str.replace(&#39;,&#39;, &#39;&#39;)<br>calendar[&#39;price&#39;] = calendar[&#39;price&#39;].astype(float)</pre><p name="1fcf" id="1fcf" class="graf graf--p graf-after--pre">Next I calculated the percentage of occupied houses and created additional features for finding out the day of week and month of year.</p><pre name="f895" id="f895" class="graf graf--pre graf-after--p">calendar_365 = calendar.groupby(<br>    &#39;date&#39;)[&#39;available&#39;, &#39;price&#39;].mean().reset_index()<br>calendar_365.rename(<br>    columns={&#39;price&#39;: &#39;average_price&#39;, &#39;available&#39;: &#39;vacancy&#39;}, inplace=<strong class="markup--strong markup--pre-strong">True</strong>)<br>calendar_365[&#39;occupancy&#39;] = (1 - calendar_365[&#39;vacancy&#39;]) * 100<br>calendar_365[&#39;dayofweek&#39;] = calendar_365.date.dt.weekday_name.str[:3]<br>calendar_365[&#39;month&#39;] = calendar_365.date.dt.month_name().str[:3]</pre><h3 name="4681" id="4681" class="graf graf--h3 graf-after--pre">2. Exploratory Data Analysis</h3><p name="5372" id="5372" class="graf graf--p graf-after--h3">In this section, I found out some of the insights from the data like the busiest month of the year, most expensive month of the year, busiest day of the week and the most expensive day of the week.</p><pre name="ecea" id="ecea" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">def</strong> plot_calendar(groupby_col, agg_col):<br>    df_index = list(calendar_365[groupby_col].unique())<br>    grouped_df = calendar_365.groupby(<br>        groupby_col)[agg_col].mean().reindex(df_index)<br><br>    plt.plot(grouped_df)<br>    plt.ylabel(agg_col.replace(&#39;_&#39;, &#39; &#39;).title())<br>    plt.title(&quot; <strong class="markup--strong markup--pre-strong">{}</strong> by <strong class="markup--strong markup--pre-strong">{}</strong>&quot;.format(agg_col.replace(&#39;_&#39;, &#39; &#39;).title(),<br>                                 groupby_col.title()), fontsize=18, fontweight=&#39;bold&#39;)<br>    ticks = list(range(len(df_index)))<br>    labels = df_index<br>    plt.xticks(ticks, labels)<br>    plt.show()</pre><h4 name="f956" id="f956" class="graf graf--h4 graf-after--pre"><strong class="markup--strong markup--h4-strong">Q1. Which months are busiest and idlest to visit Vancouver?</strong></h4><pre name="8e3e" id="8e3e" class="graf graf--pre graf-after--h4">plot_calendar(&#39;month&#39;, &#39;occupancy&#39;)</pre><figure name="d2d8" id="d2d8" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*shoNHncZ1Mdi_kihjydO9A.png" src="https://cdn-images-1.medium.com/max/800/1*shoNHncZ1Mdi_kihjydO9A.png"></figure><p name="cb4e" id="cb4e" class="graf graf--p graf-after--figure">September is the most busy month while November is the most idle month.</p><h4 name="79f9" id="79f9" class="graf graf--h4 graf-after--p">Q2. Which months are most expensive and least expensive to visit Vancouver?</h4><pre name="0f9a" id="0f9a" class="graf graf--pre graf-after--h4">plot_calendar(&#39;month&#39;, &#39;average_price&#39;)</pre><figure name="d269" id="d269" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*_reX9bLrJMzsV0yFSy_-Eg.png" data-width="449" data-height="278" src="https://cdn-images-1.medium.com/max/800/1*_reX9bLrJMzsV0yFSy_-Eg.png"></figure><p name="78f7" id="78f7" class="graf graf--p graf-after--figure">August is the most expensive month while October and November are the least expensive months.</p><h4 name="282e" id="282e" class="graf graf--h4 graf-after--p">Q3. Which days of week are most busy and least busy to visit Vancouver?</h4><pre name="bf0a" id="bf0a" class="graf graf--pre graf-after--h4">plot_calendar(&#39;dayofweek&#39;, &#39;occupancy&#39;)</pre><figure name="215c" id="215c" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*g9SSW7CDk0A3TWYgtIWg4g.png" data-width="454" data-height="278" src="https://cdn-images-1.medium.com/max/800/1*g9SSW7CDk0A3TWYgtIWg4g.png"></figure><p name="6133" id="6133" class="graf graf--p graf-after--figure">Saturday is the busiest day while Wednesday is the idlest day.</p><h4 name="92ca" id="92ca" class="graf graf--h4 graf-after--p">Q4. Which days of week are most expensive and least expensive to visit Vancouver?</h4><pre name="f221" id="f221" class="graf graf--pre graf-after--h4">plot_calendar(&#39;dayofweek&#39;, &#39;average_price&#39;)</pre><figure name="e701" id="e701" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*zt-C6rEJnboDgbOmOi8wTw.png" src="https://cdn-images-1.medium.com/max/800/1*zt-C6rEJnboDgbOmOi8wTw.png"></figure><p name="7d97" id="7d97" class="graf graf--p graf-after--figure">Saturday is the most expensive day while Monday, Tuesday, Wednesday and Thursday are the least expensive days.</p><h4 name="8bdd" id="8bdd" class="graf graf--h4 graf-after--p"><strong class="markup--strong markup--h4-strong">Q5. Which neighborhoods has the most and the least expensive listings?</strong></h4><pre name="216d" id="216d" class="graf graf--pre graf-after--h4"><strong class="markup--strong markup--pre-strong">def</strong> plot_top_neighborhood_locations(df, groupby_col):<br>    latitude = 49.2827<br>    longitude = -123.1207<br><br>    color_list = [&#39;red&#39;, &#39;blue&#39;, &#39;gray&#39;, &#39;darkred&#39;, &#39;lightgreen&#39;,<br>                  &#39;orange&#39;, &#39;black&#39;, &#39;cadetblue&#39;, &#39;darkgreen&#39;, &#39;purple&#39;]<br><br>    grouped_df = df.groupby(groupby_col)[&#39;id&#39;].count()<br>    top_nbrhd_list = list(grouped_df.sort_values(ascending=<strong class="markup--strong markup--pre-strong">False</strong>).index[:10])<br>    top_nbrhd = listings[listings[groupby_col].isin(top_nbrhd_list)]<br>    colormap = dict(zip(top_nbrhd_list, color_list))<br>    vancouver_map = folium.Map(location=[latitude, longitude], zoom_start=12)<br>    incidents = folium.map.FeatureGroup()<br><br>    <strong class="markup--strong markup--pre-strong">for</strong> lat, lng, nbrhd <strong class="markup--strong markup--pre-strong">in</strong> zip(top_nbrhd.latitude, top_nbrhd.longitude, top_nbrhd[groupby_col]):<br>        <strong class="markup--strong markup--pre-strong">if</strong> nbrhd <strong class="markup--strong markup--pre-strong">in</strong> colormap:<br>            nbrhd_color = colormap[nbrhd]<br>            incidents.add_child(<br>                folium.vector_layers.CircleMarker(<br>                    [lat, lng],<br>                    radius=1.0, <br>                    color=nbrhd_color,<br>                    fill=<strong class="markup--strong markup--pre-strong">False</strong>,<br>                    popup=nbrhd,<br>                    fill_color=&#39;blue&#39;,<br>                    fill_opacity=0.05<br>                )<br>            )<br>    vancouver_map.add_child(incidents)<br><br>    folium.plugins.FloatImage(image_file, bottom=55,<br>                              left=70).add_to(vancouver_map)<br><br>    <strong class="markup--strong markup--pre-strong">return</strong> vancouver_map</pre><pre name="7dca" id="7dca" class="graf graf--pre graf-after--pre">plot_top_neighborhood_locations(listings, &#39;neighbourhood_group_cleansed&#39;)</pre><figure name="4a45" id="4a45" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*4XhacM24jirars3MhbRO2Q.png" src="https://cdn-images-1.medium.com/max/800/1*4XhacM24jirars3MhbRO2Q.png"></figure><p name="9c77" id="9c77" class="graf graf--p graf-after--figure">As expected Downtown Vancouver is the most expensive followed by the other famous and populated places in the city like Kitsilano, West Point Grey etc. The cheapest houses can be found in Oakridge and Renfrew–Collingwood both of which are located in eastern parts of the city.</p><h4 name="75b2" id="75b2" class="graf graf--h4 graf-after--p">Q6. How does the average price of the houses compare with the number of reviews received?</h4><h4 name="e702" id="e702" class="graf graf--h4 graf-after--h4">Scatter plot — Price vs Number of Reviews</h4><pre name="3a7f" id="3a7f" class="graf graf--pre graf-after--h4">sns.scatterplot(x=listings[&#39;number_of_reviews&#39;], y=listings[&#39;price&#39;])<br>plt.xlabel(&#39;Number of Reviews&#39;)<br>plt.ylabel(&#39;Price&#39;)<br>plt.title(&#39;Price vs Number of Reviews&#39;, fontsize=18, fontweight=&#39;bold&#39;)</pre><figure name="f691" id="f691" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*rrl05wul2Wjg3fKBWDKiZQ.png" src="https://cdn-images-1.medium.com/max/800/1*rrl05wul2Wjg3fKBWDKiZQ.png"></figure><h4 name="bac1" id="bac1" class="graf graf--h4 graf-after--figure">Scatter plot — Average price vs Number of Reviews</h4><pre name="8c65" id="8c65" class="graf graf--pre graf-after--h4"><strong class="markup--strong markup--pre-strong">def</strong> plot_price_vs_popularity(df, top_k):<br>    x = df.groupby(&#39;neighbourhood_cleansed&#39;)[<br>        &#39;number_of_reviews&#39;].mean().sort_index()[:top_k]<br>    y = df.groupby(&#39;neighbourhood_cleansed&#39;)[<br>        &#39;price&#39;].mean().sort_index()[:top_k]<br>    n = (x.reset_index()).neighbourhood_cleansed.tolist()[:top_k]<br>    fig, ax = plt.subplots(figsize=(9, 7))<br>    ax.scatter(x, y, c=y, cmap=sns.diverging_palette(<br>        220, 20, sep=20, as_cmap=<strong class="markup--strong markup--pre-strong">True</strong>), s=200)<br><br>    <strong class="markup--strong markup--pre-strong">for</strong> i, txt <strong class="markup--strong markup--pre-strong">in</strong> enumerate(n):<br>        ax.annotate(txt, (x[i], y[i]), fontsize=12)<br><br>    plt.xlabel(&#39;Average Number of Reviews&#39;)<br>    plt.ylabel(&#39;Average Price&#39;)<br>    plt.title(&#39;Average Price and Popularity of Listings&#39;,<br>              fontsize=18, fontweight=&#39;bold&#39;)</pre><pre name="cef2" id="cef2" class="graf graf--pre graf-after--pre">plot_price_vs_popularity(top_nbrhd, 25)</pre><figure name="4b5b" id="4b5b" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*GvUEjCKiV7QxMu-8ZS2Aqw.png" src="https://cdn-images-1.medium.com/max/800/1*GvUEjCKiV7QxMu-8ZS2Aqw.png"></figure><h3 name="e7da" id="e7da" class="graf graf--h3 graf-after--figure">3. Feature Engineering and Feature Selection</h3><blockquote name="a91c" id="a91c" class="graf graf--blockquote graf-after--h3">Feature engineering is the process of transforming raw data into features that better represent the underlying problem to the predictive models, resulting in improved model accuracy on unseen data.</blockquote><blockquote name="168d" id="168d" class="graf graf--blockquote graf-after--blockquote">Feature Selection is the process of selecting out the most significant features from a given dataset.</blockquote><p name="90b6" id="90b6" class="graf graf--p graf-after--blockquote">I defined the list of features of significance from the dataset.</p><pre name="39e6" id="39e6" class="graf graf--pre graf-after--p">features = [&#39;cancellation_policy&#39;, &#39;is_location_exact&#39;, &#39;accommodates&#39;, &#39;reviews_per_month&#39;, &#39;property_type&#39;, &#39;price&#39;,<br>            &#39;host_total_listings_count&#39;, &#39;extra_people&#39;, &#39;calculated_host_listings_count&#39;, &#39;guests_included&#39;,<br>            &#39;review_scores_rating&#39;, &#39;host_response_time&#39;, &#39;number_of_reviews&#39;, &#39;host_is_superhost&#39;, &#39;room_type&#39;,<br>            &#39;instant_bookable&#39;, &#39;amenities&#39;, &#39;host_identity_verified&#39;, &#39;host_has_profile_pic&#39;, &#39;security_deposit&#39;,<br>            &#39;host_listings_count&#39;, &#39;requires_license&#39;, &#39;neighbourhood_group_cleansed&#39;, &#39;neighbourhood_cleansed&#39;,<br>            &#39;minimum_nights&#39;, &#39;bathrooms&#39;, &#39;require_guest_phone_verification&#39;, &#39;cleaning_fee&#39;]</pre><p name="dc3b" id="dc3b" class="graf graf--p graf-after--pre">Next I defined the numerical and the categorical features. I used mode (most common value) for filling the missing categorical information while I used the median value for filling the missing numerical information.</p><pre name="dd4f" id="dd4f" class="graf graf--pre graf-after--p">num_cols = data_clean.select_dtypes(exclude=&#39;object&#39;).columns<br>cat_cols = data_clean.select_dtypes(include=&#39;object&#39;).columns<br>data_clean[cat_cols] = data_clean[cat_cols].apply(<br>    <strong class="markup--strong markup--pre-strong">lambda</strong> col: col.fillna(col.mode()[0]))<br>data_clean[num_cols] = data_clean[num_cols].apply(<br>    <strong class="markup--strong markup--pre-strong">lambda</strong> col: col.fillna(col.median()))</pre><h3 name="9764" id="9764" class="graf graf--h3 graf-after--pre">Correlation matrix</h3><p name="c8cb" id="c8cb" class="graf graf--p graf-after--h3">Correlation matrix is used to show how the features are related to each other or the target variable.Correlation can be positive (increase in one value of feature increases the value of the target variable) or negative (increase in one value of feature decreases the value of the target variable).</p><pre name="1014" id="1014" class="graf graf--pre graf-after--p">corr_matrix = data_clean.corr()<br>corr_matrix = abs(corr_matrix)<br>f, ax = plt.subplots(figsize=(20, 9))<br>sns.heatmap(corr_matrix, vmax=0.8, vmin=0.05, annot=<strong class="markup--strong markup--pre-strong">True</strong>)</pre><figure name="e04f" id="e04f" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*gh0_QfHXrCi7LxacsgD_Fw.png" data-width="1405" data-height="758" src="https://cdn-images-1.medium.com/max/800/1*gh0_QfHXrCi7LxacsgD_Fw.png"></figure><p name="e60b" id="e60b" class="graf graf--p graf-after--figure">Let us see the the Correlation coefficients of the various features present in the dataset with price.</p><pre name="5130" id="5130" class="graf graf--pre graf-after--p">corr_matrix[&#39;price&#39;].sort_values(ascending=<strong class="markup--strong markup--pre-strong">False</strong>)</pre><figure name="5213" id="5213" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*muwOOok7j1vIDvWp_FxSsg.png" src="https://cdn-images-1.medium.com/max/800/1*muwOOok7j1vIDvWp_FxSsg.png"></figure><p name="2b41" id="2b41" class="graf graf--p graf-after--figure">Features with the highest weight in predicting prices are number of bathrooms and the number of accommodations.</p><pre name="49be" id="49be" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">def</strong> transform_data(df, num_cols, cat_cols):<br>    transformed_df = df.copy()<br><br>    <strong class="markup--strong markup--pre-strong">for</strong> col <strong class="markup--strong markup--pre-strong">in</strong> cat_cols:<br>        transformed_df[col] = transformed_df[col].astype(&#39;category&#39;)<br>        transformed_df = pd.concat([transformed_df.drop(<br>            col, axis=1), pd.get_dummies(transformed_df[col], prefix=col)], axis=1)<br>    transformed_df[num_cols] = transformed_df[num_cols].apply(<br>        <strong class="markup--strong markup--pre-strong">lambda</strong> x: np.log(x+1))<br><br>    num_cols.remove(&#39;price&#39;)<br>    scaler = MinMaxScaler()<br>    transformed_df[num_cols] = scaler.fit_transform(transformed_df[num_cols])<br><br>    <strong class="markup--strong markup--pre-strong">return</strong> transformed_df</pre><pre name="1a5a" id="1a5a" class="graf graf--pre graf-after--pre">transformed_df = transform_data(data_clean[selected_cols], num_cols, cat_cols)</pre><h3 name="35aa" id="35aa" class="graf graf--h3 graf-after--pre">4. Evaluate the Best Model on the Testing Set</h3><p name="2da4" id="2da4" class="graf graf--p graf-after--h3">I used 20% of the dataset for testing while the rest is used for training the model. I have used Light GBM for training the model and R² as the evaluation metric since this is a regression problem.</p><pre name="7099" id="7099" class="graf graf--pre graf-after--p"><strong class="markup--strong markup--pre-strong">def</strong> train_and_test(df, model, test_size=0.2):<br>    target = transformed_df[&#39;price&#39;]<br>    features = transformed_df.copy().drop(&#39;price&#39;, axis=1)<br><br>    X_train, X_test, y_train, y_test = train_test_split(<br>        features, target, test_size=test_size, random_state=42)<br><br>    model.fit(X_train, y_train)  <br>    y_pred = model.predict(X_test) <br>    print(&#39;R^2 test: <strong class="markup--strong markup--pre-strong">%.3f</strong>&#39; % (r2_score(y_test, y_pred)))<br>    pred = np.round(np.exp(y_pred) + 1, 1)<br>    actual = np.round(np.exp(y_test) + 1, 1)<br>    plt.scatter(actual.as_matrix(), pred)<br>    plt.title(&#39;Predicted vs. Actual Price&#39;, fontsize=18, fontweight=&#39;bold&#39;)<br>    plt.xlabel(&#39;Actual Listing Price&#39;)<br>    plt.ylabel(&#39;Predicted Listing Price&#39;)<br>    plt.show()<br><br>    <strong class="markup--strong markup--pre-strong">return</strong> model</pre><h3 name="24b9" id="24b9" class="graf graf--h3 graf-after--pre">Using Light GBM as the Regression Model</h3><p name="f47d" id="f47d" class="graf graf--p graf-after--h3">Light GBM is a fast, distributed, high-performance gradient boosting framework based on decision tree algorithm, used for ranking, classification and many other machine learning tasks. It splits the tree leaf wise with the best fit while the other boosting algorithms like Xgboost splits the tree depth wise or level wise. So when growing on the same leaf in Light GBM, the leaf-wise algorithm can reduce more loss than the level-wise algorithm and hence results in much better accuracy compared to other boosting algorithms.</p><figure name="9860" id="9860" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*vSIJmgxThe4wvwHtCobOAw.png" data-width="1024" data-height="177" src="https://cdn-images-1.medium.com/max/800/1*vSIJmgxThe4wvwHtCobOAw.png"><figcaption class="imageCaption">Level wise growth (example Xgboost) vs leaf wise growth(example Light GBM)</figcaption></figure><h3 name="4bd5" id="4bd5" class="graf graf--h3 graf-after--figure">Advantages of Light GBM</h3><ol class="postList"><li name="9e8d" id="9e8d" class="graf graf--li graf-after--h3">Faster training speed and convergence</li><li name="6bbd" id="6bbd" class="graf graf--li graf-after--li">Lower memory usage</li><li name="40c5" id="40c5" class="graf graf--li graf-after--li">Can handle very large size data-sets</li><li name="3214" id="3214" class="graf graf--li graf-after--li">Better accuracy than any other boosting algorithm</li></ol><h3 name="589a" id="589a" class="graf graf--h3 graf-after--li">5. Interpret the Model Results</h3><p name="48d6" id="48d6" class="graf graf--p graf-after--h3">Let us see the scatter plot of predicted vs actual prices after training the model using Light GBM. The value of the R² coefficient is found to be 0.632.</p><pre name="30c3" id="30c3" class="graf graf--pre graf-after--p">model = LGBMRegressor()<br>trained_model = train_and_test(transformed_df, model)</pre><figure name="a3ef" id="a3ef" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*LU3lODmLZYkC8SQVt3kztA.png" src="https://cdn-images-1.medium.com/max/800/1*LU3lODmLZYkC8SQVt3kztA.png"></figure><p name="f6e8" id="f6e8" class="graf graf--p graf-after--figure">Finally, I plotted the feature importance of the various features in explaining the price of the houses in Vancouver.</p><pre name="b34e" id="b34e" class="graf graf--pre graf-after--p">feat_imp = pd.Series(trained_model.feature_importances_,<br>                     index=transformed_df.columns.drop(&#39;price&#39;))<br>feat_imp.nlargest(15).plot(kind=&#39;barh&#39;, figsize=(10, 6))<br>plt.xlabel(&#39;Relative Importance&#39;)<br>plt.title(&quot;Feature importances&quot;, fontsize=18, fontweight=&#39;bold&#39;)<br>plt.show()</pre><figure name="eccf" id="eccf" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*zVNWIC3MLr7RcIcd0J8cNg.png" data-width="1037" data-height="403" src="https://cdn-images-1.medium.com/max/800/1*zVNWIC3MLr7RcIcd0J8cNg.png"></figure><p name="3076" id="3076" class="graf graf--p graf-after--figure graf--trailing">As can be seen from the plot, cleaning fee is the most important feature followed by the number of amenities in the house and reviews given per month.</p></div></div></section><section name="3b63" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="d469" id="d469" class="graf graf--h3 graf--leading">Conclusions</h3><p name="2278" id="2278" class="graf graf--p graf-after--h3">In this article, I demonstrated how to make a machine learning project from scratch. I started with cleaning the data and getting insights from it. I followed by doing feature engineering and feature selection. This is probably the most important step in a machine learning project as it helps in increasing accuracy, avoiding over-fitting and reduce training time of the model. I used Light GBM as the model for regression with R² as the evaluation metric. Finally, I plotted the feature importance to find out the most important features in predicting the house prices.</p><h3 name="61c4" id="61c4" class="graf graf--h3 graf-after--p">References/Further Readings</h3><div name="dace" id="dace" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://www.telegraph.co.uk/travel/destinations/north-america/canada/vancouver/articles/vancouver-what-to-see-and-do-why-you-should-go/" data-href="https://www.telegraph.co.uk/travel/destinations/north-america/canada/vancouver/articles/vancouver-what-to-see-and-do-why-you-should-go/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.telegraph.co.uk/travel/destinations/north-america/canada/vancouver/articles/vancouver-what-to-see-and-do-why-you-should-go/"><strong class="markup--strong markup--mixtapeEmbed-strong">15 reasons why Vancouver is the greatest city on Earth</strong><br><em class="markup--em markup--mixtapeEmbed-em">Vancouver witnessed its biggest ever year for tourism in 2016, with a record 10 million overnight stays - an increase…</em>www.telegraph.co.uk</a><a href="https://www.telegraph.co.uk/travel/destinations/north-america/canada/vancouver/articles/vancouver-what-to-see-and-do-why-you-should-go/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="76a62696252e2e31c5943b33796416a2" data-thumbnail-img-id="0*RKbAfXBcb49KcqWI" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*RKbAfXBcb49KcqWI);"></a></div><div name="bdb2" id="bdb2" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://neilpatel.com/blog/how-airbnb-uses-data-science/" data-href="https://neilpatel.com/blog/how-airbnb-uses-data-science/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://neilpatel.com/blog/how-airbnb-uses-data-science/"><strong class="markup--strong markup--mixtapeEmbed-strong">How Airbnb Uses Data Science to Improve Their Product and Marketing</strong><br><em class="markup--em markup--mixtapeEmbed-em">Since its humble beginnings, Airbnb has made no secret of its heavy use of data science to build new product offerings…</em>neilpatel.com</a><a href="https://neilpatel.com/blog/how-airbnb-uses-data-science/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="a10c91c81cb9942b151db16cedcc28d6" data-thumbnail-img-id="0*GtaQevGiaDDXJ1Rn" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*GtaQevGiaDDXJ1Rn);"></a></div><div name="aeb4" id="aeb4" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://medium.com/ml2vec/data-analysis-on-the-airbnb-dataset-e0be9254eeb9" data-href="https://medium.com/ml2vec/data-analysis-on-the-airbnb-dataset-e0be9254eeb9" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/ml2vec/data-analysis-on-the-airbnb-dataset-e0be9254eeb9"><strong class="markup--strong markup--mixtapeEmbed-strong">Data Analysis on the AirBnb Dataset</strong><br><em class="markup--em markup--mixtapeEmbed-em">In this post, I will be analyzing the AirBnB Dataset using visualizations and learning models, using the CRISP-DM…</em>medium.com</a><a href="https://medium.com/ml2vec/data-analysis-on-the-airbnb-dataset-e0be9254eeb9" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="1eed8ce7ede00e230ac60945427088c1" data-thumbnail-img-id="1*h8oW90wcwjvkj1rbdtNQQA.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*h8oW90wcwjvkj1rbdtNQQA.jpeg);"></a></div><div name="3643" id="3643" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://towardsdatascience.com/airbnb-rental-listings-dataset-mining-f972ed08ddec" data-href="https://towardsdatascience.com/airbnb-rental-listings-dataset-mining-f972ed08ddec" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://towardsdatascience.com/airbnb-rental-listings-dataset-mining-f972ed08ddec"><strong class="markup--strong markup--mixtapeEmbed-strong">Airbnb Rental Listings Dataset Mining</strong><br><em class="markup--em markup--mixtapeEmbed-em">An Exploratory Analysis of Airbnb’s Data to understand the rental landscape in New York City</em>towardsdatascience.com</a><a href="https://towardsdatascience.com/airbnb-rental-listings-dataset-mining-f972ed08ddec" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="821cd54966a8346506e4d8d2477c934a" data-thumbnail-img-id="1*8YkPfHUVLClEvzEl0dzh-Q.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*8YkPfHUVLClEvzEl0dzh-Q.jpeg);"></a></div><h3 name="ac56" id="ac56" class="graf graf--h3 graf-after--mixtapeEmbed">Before You Go</h3><p name="d24e" id="d24e" class="graf graf--p graf-after--h3">The corresponding source code can be found here:</p><div name="ae18" id="ae18" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://github.com/abhinavsagar/Airbnb-in-Vancouver" data-href="https://github.com/abhinavsagar/Airbnb-in-Vancouver" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/abhinavsagar/Airbnb-in-Vancouver"><strong class="markup--strong markup--mixtapeEmbed-strong">abhinavsagar/Airbnb-in-Vancouver</strong><br><em class="markup--em markup--mixtapeEmbed-em">You can&#39;t perform that action at this time. You signed in with another tab or window. You signed out in another tab or…</em>github.com</a><a href="https://github.com/abhinavsagar/Airbnb-in-Vancouver" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="f6a0b3d29eb26c9ef6b715512bbe636e" data-thumbnail-img-id="0*J7ma_KCj8B05TTrY" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*J7ma_KCj8B05TTrY);"></a></div><h3 name="3b88" id="3b88" class="graf graf--h3 graf-after--mixtapeEmbed">Contacts</h3><p name="49df" id="49df" class="graf graf--p graf-after--h3">If you want to keep updated with my latest articles and projects <a href="https://medium.com/@abhinav.sagar" data-href="https://medium.com/@abhinav.sagar" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">follow me on Medium</a>. These are some of my contacts details:</p><ul class="postList"><li name="8c1b" id="8c1b" class="graf graf--li graf-after--p"><a href="https://in.linkedin.com/in/abhinavsagar4" data-href="https://in.linkedin.com/in/abhinavsagar4" class="markup--anchor markup--li-anchor" rel="noopener nofollow noopener" target="_blank">Linkedin</a></li><li name="7dea" id="7dea" class="graf graf--li graf-after--li"><a href="https://medium.com/@abhinav.sagar" data-href="https://medium.com/@abhinav.sagar" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Medium Profile</a></li><li name="9c3a" id="9c3a" class="graf graf--li graf-after--li"><a href="https://github.com/abhinavsagar" data-href="https://github.com/abhinavsagar" class="markup--anchor markup--li-anchor" rel="noopener nofollow noopener" target="_blank">GitHub</a></li><li name="20e5" id="20e5" class="graf graf--li graf-after--li"><a href="https://www.kaggle.com/abhinavsagar" data-href="https://www.kaggle.com/abhinavsagar" class="markup--anchor markup--li-anchor" rel="noopener nofollow noopener" target="_blank">Kaggle</a></li><li name="7f66" id="7f66" class="graf graf--li graf-after--li"><a href="https://abhinavsagar.github.io/" data-href="https://abhinavsagar.github.io/" class="markup--anchor markup--li-anchor" rel="noopener nofollow noopener" target="_blank">Personal Website</a></li></ul><p name="169d" id="169d" class="graf graf--p graf-after--li graf--trailing">Happy reading, happy learning and happy coding!</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@abhinav.sagar" class="p-author h-card">Abhinav Sagar</a> on <a href="https://medium.com/p/1b42ca52eece"><time class="dt-published" datetime="2019-11-15T11:52:38.110Z">November 15, 2019</time></a>.</p><p><a href="https://medium.com/@abhinav.sagar/predicting-airbnb-prices-using-machine-learning-in-vancouver-1b42ca52eece" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 28, 2021.</p></footer></article></body></html>