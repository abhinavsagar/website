<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>A Hands on Guide to Multiprocessing in Python</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">A Hands on Guide to Multiprocessing in Python</h1>
</header>
<section data-field="subtitle" class="p-summary">
Getting started with parallel programming and speed up your python programs
</section>
<section data-field="body" class="e-content">
<section name="a880" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="a6b9" id="a6b9" class="graf graf--h3 graf--leading graf--title">A Hands on Guide to Multiprocessing in Python</h3><h4 name="5699" id="5699" class="graf graf--h4 graf-after--h3 graf--subtitle">Getting started with parallel programming and speed up your python programs</h4></div><div class="section-inner sectionLayout--fullWidth"><figure name="a4cb" id="a4cb" class="graf graf--figure graf--layoutFillWidth graf-after--h4"><img class="graf-image" data-image-id="1*eubQ7JUanaKHAC7B7ev4Eg.jpeg" data-width="4096" data-height="2726" data-is-featured="true" src="https://cdn-images-1.medium.com/max/2560/1*eubQ7JUanaKHAC7B7ev4Eg.jpeg"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@white73widow?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/@white73widow?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Luca Campioni</a> on <a href="https://unsplash.com/s/photos/fast?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/s/photos/fast?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Unsplash</a></figcaption></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="d492" id="d492" class="graf graf--p graf-after--figure graf--trailing">Stuck behind the paywall? Click <a href="https://medium.com/p/a-hands-on-guide-to-multiprocessing-in-python-48b59bfcc89e?source=email-c3f5233f3441--writer.postDistributed&amp;sk=0ab941bd932c4816142a0f8eb0c923de" data-href="https://medium.com/p/a-hands-on-guide-to-multiprocessing-in-python-48b59bfcc89e?source=email-c3f5233f3441--writer.postDistributed&amp;sk=0ab941bd932c4816142a0f8eb0c923de" class="markup--anchor markup--p-anchor" target="_blank">here</a> to read the full story with my Friend Link!</p></div></div></section><section name="7b23" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><p name="72a7" id="72a7" class="graf graf--p graf--leading">This guide aims to explain why multi-processing is needed and how to use them in your programs. As a machine learning researcher, I use them extensively while preparing data for my models and feature engineering.</p><p name="930c" id="930c" class="graf graf--p graf-after--p">Python is slow. To increase the speed of processing in Python, code can be made to run on multiple processes. This parallelization allows for the distribution of work across all the available CPU cores. When running on multiple cores long running jobs can be broken down into smaller manageable chunks. Once the individual jobs are run in parallel the results are returned and in this manner the time to process is cut down drastically.</p><h3 name="6b11" id="6b11" class="graf graf--h3 graf-after--p">Python’s GIL problem</h3><p name="afc5" id="afc5" class="graf graf--p graf-after--h3">The GIL or Global Interpreter Lock is a boolean value in the Python interpreter protected by a mutex. The lock is used by the core bytecode evaluation loop in CPython to set which thread is currently executing the statements. GIL in Python prevent two threads from simultaneously executing in the same program or sharing the same resources.</p><h3 name="13fb" id="13fb" class="graf graf--h3 graf-after--p">How to deal with Python’s GIL problem</h3><ol class="postList"><li name="e4a8" id="e4a8" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">Using multi-processing</strong> — The most popular way is to use a multi-processing approach where you use multiple processes instead of threads. Each Python process gets its own Python interpreter and memory space so that GIL won’t be a problem.</li><li name="6808" id="6808" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Using a different interpreter</strong> — Python has multiple interpreter implementations. GIL exists only in the original Python implementation that is CPython. If your program with its libraries is available for one of the other implementations then you can try them out as well.</li></ol><h3 name="80b3" id="80b3" class="graf graf--h3 graf-after--li">The Normal Approach</h3><p name="a714" id="a714" class="graf graf--p graf-after--h3">Let us see the time taken to check and display the single digit prime numbers using the traditional for-loop iteration. The loops use only 30 to 40 percent of the available CPU power in this case, hence the time taken for computation is more.</p><pre name="2138" id="2138" class="graf graf--pre graf-after--p">import time</pre><pre name="5b8b" id="5b8b" class="graf graf--pre graf-after--pre">def is_prime(n):<br>      if (n &lt;= 1) : <br>          return &#39;not a prime number&#39;<br>      if (n &lt;= 3) : <br>          return &#39;prime number&#39;<br>          <br>      if (n % 2 == 0 or n % 3 == 0) : <br>          return &#39;not a prime number&#39;<br>    <br>      i = 5<br>      while(i * i &lt;= n) : <br>          if (n % i == 0 or n % (i + 2) == 0) : <br>              return &#39;not a prime number&#39;<br>          i = i + 6<br>    <br>      return &#39;prime number&#39;<br>    <br>starttime = time.time()<br>for i in range(1,10):<br>    time.sleep(2)<br>    print(&#39;{} is {} number&#39;.format(i, is_prime(i)))</pre><pre name="e1ff" id="e1ff" class="graf graf--pre graf-after--pre">print()    <br>print(&#39;Time taken = {} seconds&#39;.format(time.time() - starttime))</pre><figure name="a637" id="a637" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*y49uIX5VXBWmNoe6v-540g.png" data-width="487" data-height="332" src="https://cdn-images-1.medium.com/max/800/1*y49uIX5VXBWmNoe6v-540g.png"></figure><h3 name="8a83" id="8a83" class="graf graf--h3 graf-after--figure">Using Multiprocessing</h3><p name="5fda" id="5fda" class="graf graf--p graf-after--h3">Multiprocessing refers to the ability of a system to support more than one processor at the same time. Applications in a multiprocessing system are broken to smaller chunks of code that run independently. The operating system allocates these threads to the processors improving performance of the system. It does two things at the same time, either running code simultaneously on different CPUs or running code on the same CPU and achieving speedups by taking advantage of “wasted” CPU cycles while your program is waiting for external resources like file loading, API calls etcetera.</p><figure name="478f" id="478f" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="0*q0fRNZLeYeXh601X.jpg" data-width="407" data-height="276" src="https://cdn-images-1.medium.com/max/800/0*q0fRNZLeYeXh601X.jpg"><figcaption class="imageCaption">Multiprocessing</figcaption></figure><h3 name="76f7" id="76f7" class="graf graf--h3 graf-after--figure">Advantages of Multiprocessing</h3><ol class="postList"><li name="a179" id="a179" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">Increased Throughput</strong> − By increasing the number of processors, more work can be completed in the same time.</li><li name="9dc9" id="9dc9" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Cost Saving</strong> − Parallel system shares the memory, buses, peripherals etc. Multiprocessor system thus saves money as compared to multiple single systems. Also, if a number of programs operate on the same data, it is cheaper to store that data on one single disk and shared by all processors of the system instead of using many copies of the same data.</li><li name="5d98" id="5d98" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Increased Reliability</strong> − In this system, as the workload is distributed among several processors which results in increased reliability. If one processor fails then its failure may slightly slow down the speed of the system but system will work smoothly.</li></ol><p name="026e" id="026e" class="graf graf--p graf-after--li">Let us see how we can use multiprocessing so that full (100%) of CPU could be utilized on a multicore machine, hence reducing computation time drastically. There are two ways to achieve the same — using Process class and Pool class which are described in the next two sections.</p><h3 name="aaea" id="aaea" class="graf graf--h3 graf-after--p">Using Process class</h3><p name="d29f" id="d29f" class="graf graf--p graf-after--h3">The process class stores the processes in memory and allocates the jobs to the available processors using a FIFO scheduling. When the process is ended, it pre-empts and plans the new process for execution.</p><pre name="0e77" id="0e77" class="graf graf--pre graf-after--p">import time<br>import multiprocessing</pre><pre name="5140" id="5140" class="graf graf--pre graf-after--pre">def is_prime(n):<br>      if (n &lt;= 1) : <br>          return &#39;not a prime number&#39;<br>      if (n &lt;= 3) : <br>          return &#39;prime number&#39;<br>          <br>      if (n % 2 == 0 or n % 3 == 0) : <br>          return &#39;not a prime number&#39;<br>    <br>      i = 5<br>      while(i * i &lt;= n) : <br>          if (n % i == 0 or n % (i + 2) == 0) : <br>              return &#39;not a prime number&#39;<br>          i = i + 6<br>    <br>      return &#39;prime number&#39;</pre><pre name="1b2c" id="1b2c" class="graf graf--pre graf-after--pre">def multiprocessing_func(x):<br>    time.sleep(2)<br>    print(&#39;{} is {} number&#39;.format(x, is_prime(x)))<br>    <br>if __name__ == &#39;__main__&#39;:<br>    starttime = time.time()<br>    processes = []<br>    for i in range(1,10):<br>        p = multiprocessing.Process(target=multiprocessing_func, args=(i,))<br>        processes.append(p)<br>        p.start()<br>        <br>    for process in processes:<br>        process.join()<br>        <br>    print()    <br>    print(&#39;Time taken = {} seconds&#39;.format(time.time() - starttime))</pre><figure name="eca0" id="eca0" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*44lINvP-3XntPe7nR4kgTQ.png" data-width="468" data-height="327" src="https://cdn-images-1.medium.com/max/800/1*44lINvP-3XntPe7nR4kgTQ.png"></figure><p name="d176" id="d176" class="graf graf--p graf-after--figure">As we can see, the time taken for the computation has been reduced from 18.02 sec to 2.12 sec using the Process class.</p><h3 name="7ccb" id="7ccb" class="graf graf--h3 graf-after--p">Using Pool class</h3><p name="9619" id="9619" class="graf graf--p graf-after--h3">The pool class schedules execution using FIFO policy. It workings like a map reduce design. The input are mapped from different processors and bring together the output from all the processors. After the running the code, it restores the output in the form of a list or array. It waits for all the jobs to finish and then returns the output. The processes in execution are put in memory and other non-executing processes are puts away out of memory.</p><pre name="0581" id="0581" class="graf graf--pre graf-after--p">import time<br>import multiprocessing</pre><pre name="ce7d" id="ce7d" class="graf graf--pre graf-after--pre">def is_prime(n):<br>      if (n &lt;= 1) : <br>          return &#39;not a prime number&#39;<br>      if (n &lt;= 3) : <br>          return &#39;prime number&#39;<br>          <br>      if (n % 2 == 0 or n % 3 == 0) : <br>          return &#39;not a prime number&#39;<br>    <br>      i = 5<br>      while(i * i &lt;= n) : <br>          if (n % i == 0 or n % (i + 2) == 0) : <br>              return &#39;not a prime number&#39;<br>          i = i + 6<br>    <br>      return &#39;prime number&#39;</pre><pre name="88d5" id="88d5" class="graf graf--pre graf-after--pre">def multiprocessing_func(x):<br>    time.sleep(2)<br>    print(&#39;{} is {} number&#39;.format(x, is_prime(x)))<br>    <br>if __name__ == &#39;__main__&#39;:<br>    starttime = time.time()<br>    pool = multiprocessing.Pool()<br>    pool.map(multiprocessing_func, range(1,10))<br>    pool.close()<br>    print()<br>    print(&#39;Time taken = {} seconds&#39;.format(time.time() - starttime))</pre><figure name="9feb" id="9feb" class="graf graf--figure graf-after--pre"><img class="graf-image" data-image-id="1*ubuThDHEEP9Cn2vBT3FS9g.png" data-width="463" data-height="325" src="https://cdn-images-1.medium.com/max/800/1*ubuThDHEEP9Cn2vBT3FS9g.png"></figure><p name="dc07" id="dc07" class="graf graf--p graf-after--figure">The time taken for the computation has been reduced from 18.02 sec to 6.07 sec using the Pool class.</p><h3 name="7a44" id="7a44" class="graf graf--h3 graf-after--p">Conclusions</h3><p name="b255" id="b255" class="graf graf--p graf-after--h3">As a quick recap, I presented with the Python’s GIL problem and how multi-processing can help eliminate it. I continued with showing how multi-processing can reduce the computation time drastically by making full use of the CPU. As the trend of increasing parallelism at the hardware level will continue for the foreseeable future, parallel computation will become more and more important in application programming. There is a very active body of research on making parallelism easier and less error-prone for programmers.</p><h3 name="a096" id="a096" class="graf graf--h3 graf-after--p">References/Further Readings</h3><div name="5fc7" id="5fc7" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://docs.python.org/3/library/multiprocessing.html" data-href="https://docs.python.org/3/library/multiprocessing.html" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://docs.python.org/3/library/multiprocessing.html"><strong class="markup--strong markup--mixtapeEmbed-strong">multiprocessing - Process-based parallelism - Python 3.8.0 documentation</strong><br><em class="markup--em markup--mixtapeEmbed-em">is a package that supports spawning processes using an API similar to the module. The package offers both local and…</em>docs.python.org</a><a href="https://docs.python.org/3/library/multiprocessing.html" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="9910abfbd6b1e579867a7354af3ba657"></a></div><div name="de29" id="de29" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://sebastianraschka.com/Articles/2014_multiprocessing.html" data-href="https://sebastianraschka.com/Articles/2014_multiprocessing.html" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://sebastianraschka.com/Articles/2014_multiprocessing.html"><strong class="markup--strong markup--mixtapeEmbed-strong">An introduction to parallel programming using Python&#39;s multiprocessing module</strong><br><em class="markup--em markup--mixtapeEmbed-em">CPUs with multiple cores have become the standard in the recent development of modern computer architectures and we can…</em>sebastianraschka.com</a><a href="https://sebastianraschka.com/Articles/2014_multiprocessing.html" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="5d7e08dd5cd94315fd4085a2005ca526"></a></div><h3 name="f8e6" id="f8e6" class="graf graf--h3 graf-after--mixtapeEmbed">Contacts</h3><p name="3eaf" id="3eaf" class="graf graf--p graf-after--h3">If you want to keep updated with my latest articles and projects <a href="https://medium.com/@abhinav.sagar" data-href="https://medium.com/@abhinav.sagar" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">follow me on Medium</a>. These are some of my contacts details:</p><ul class="postList"><li name="fa5d" id="fa5d" class="graf graf--li graf-after--p"><a href="https://in.linkedin.com/in/abhinavsagar4" data-href="https://in.linkedin.com/in/abhinavsagar4" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Linkedin</a></li><li name="a70c" id="a70c" class="graf graf--li graf-after--li"><a href="https://medium.com/@abhinav.sagar" data-href="https://medium.com/@abhinav.sagar" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Medium Profile</a></li><li name="eaf9" id="eaf9" class="graf graf--li graf-after--li"><a href="https://github.com/abhinavsagar" data-href="https://github.com/abhinavsagar" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">GitHub</a></li><li name="20c2" id="20c2" class="graf graf--li graf-after--li"><a href="https://www.kaggle.com/abhinavsagar" data-href="https://www.kaggle.com/abhinavsagar" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Kaggle</a></li><li name="2733" id="2733" class="graf graf--li graf-after--li"><a href="https://abhinavsagar.github.io/" data-href="https://abhinavsagar.github.io/" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Personal Website</a></li></ul><p name="8b4b" id="8b4b" class="graf graf--p graf-after--li graf--trailing">Happy reading, happy learning and happy coding!</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@abhinav.sagar" class="p-author h-card">Abhinav Sagar</a> on <a href="https://medium.com/p/48b59bfcc89e"><time class="dt-published" datetime="2019-11-03T11:53:34.718Z">November 3, 2019</time></a>.</p><p><a href="https://medium.com/@abhinav.sagar/a-hands-on-guide-to-multiprocessing-in-python-48b59bfcc89e" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 28, 2021.</p></footer></article></body></html>