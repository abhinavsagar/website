<!DOCTYPE html><html><head><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Pedestrian detection using Non Maximum Suppression</title><style>
      * {
        font-family: Georgia, Cambria, "Times New Roman", Times, serif;
      }
      html, body {
        margin: 0;
        padding: 0;
      }
      h1 {
        font-size: 50px;
        margin-bottom: 17px;
        color: #333;
      }
      h2 {
        font-size: 24px;
        line-height: 1.6;
        margin: 30px 0 0 0;
        margin-bottom: 18px;
        margin-top: 33px;
        color: #333;
      }
      h3 {
        font-size: 30px;
        margin: 10px 0 20px 0;
        color: #333;
      }
      header {
        width: 640px;
        margin: auto;
      }
      section {
        width: 640px;
        margin: auto;
      }
      section p {
        margin-bottom: 27px;
        font-size: 20px;
        line-height: 1.6;
        color: #333;
      }
      section img {
        max-width: 640px;
      }
      footer {
        padding: 0 20px;
        margin: 50px 0;
        text-align: center;
        font-size: 12px;
      }
      .aspectRatioPlaceholder {
        max-width: auto !important;
        max-height: auto !important;
      }
      .aspectRatioPlaceholder-fill {
        padding-bottom: 0 !important;
      }
      header,
      section[data-field=subtitle],
      section[data-field=description] {
        display: none;
      }
      </style></head><body><article class="h-entry">
<header>
<h1 class="p-name">Pedestrian detection using Non Maximum Suppression</h1>
</header>
<section data-field="subtitle" class="p-summary">
A complete pipeline for detecting pedestrians on the road
</section>
<section data-field="body" class="e-content">
<section name="47cd" class="section section--body section--first"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="bef0" id="bef0" class="graf graf--h3 graf--leading graf--title">Pedestrian detection using Non Maximum Suppression algorithm</h3><h4 name="3ed2" id="3ed2" class="graf graf--h4 graf-after--h3 graf--subtitle">A complete pipeline for detecting pedestrians on the road</h4></div><div class="section-inner sectionLayout--fullWidth"><figure name="bcf8" id="bcf8" class="graf graf--figure graf--layoutFillWidth graf-after--h4"><img class="graf-image" data-image-id="1*Ouy0WUSkz8pzKWon4Vxktw.jpeg" data-width="4219" data-height="2802" data-is-featured="true" src="https://cdn-images-1.medium.com/max/2560/1*Ouy0WUSkz8pzKWon4Vxktw.jpeg"><figcaption class="imageCaption">Photo by <a href="https://unsplash.com/@davidmarcu?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/@davidmarcu?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">David Marcu</a> on <a href="https://unsplash.com/search/photos/pedestrians?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" data-href="https://unsplash.com/search/photos/pedestrians?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText" class="markup--anchor markup--figure-anchor" rel="noopener" target="_blank">Unsplash</a></figcaption></figure></div><div class="section-inner sectionLayout--insetColumn"><p name="125f" id="125f" class="graf graf--p graf-after--figure">Stuck behind the paywall? Click <a href="https://medium.com/p/pedestrian-detection-using-non-maximum-suppression-b55b89cefc6?source=email-c3f5233f3441--writer.postDistributed&amp;sk=996dc63e6fe2ca6cb15ad2934f527ecc" data-href="https://medium.com/p/pedestrian-detection-using-non-maximum-suppression-b55b89cefc6?source=email-c3f5233f3441--writer.postDistributed&amp;sk=996dc63e6fe2ca6cb15ad2934f527ecc" class="markup--anchor markup--p-anchor" target="_blank">here</a> to read the full story with my Friend Link!</p><p name="02fe" id="02fe" class="graf graf--p graf-after--p">Pedestrian detection is still an unsolved problem in computer science. While many object detection algorithms like YOLO, SSD, RCNN, Fast R-CNN and Faster R-CNN have been researched a lot to great success but still pedestrian detection in crowded scenes remains an open challenge.</p><p name="6e5a" id="6e5a" class="graf graf--p graf-after--p">In recent years, pedestrian detection is urgently required in the real-world scenario where the density of people is high, i.e., airports, train stations, shopping malls etc. Despite great progress achieved, detecting pedestrians in those scenes still remains difficult, evidenced by significant performance drops of state of the art methods. In this post, I will go through an efficient and scalable algorithm known as <strong class="markup--strong markup--p-strong">Non Maximum Suppression</strong> for solving pedestrian/person detection in crowded scenes.</p><h3 name="520b" id="520b" class="graf graf--h3 graf-after--p">APPLICATIONS</h3><ol class="postList"><li name="94d9" id="94d9" class="graf graf--li graf-after--h3"><strong class="markup--strong markup--li-strong">Self driving cars.</strong> Identifying pedestrians on a road scene</li><li name="85f8" id="85f8" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Security.</strong> Restrict access for certain people to certain places</li><li name="ee8e" id="ee8e" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Retail.</strong> Analysing visitors behaviour within a supermarket</li><li name="7354" id="7354" class="graf graf--li graf-after--li"><strong class="markup--strong markup--li-strong">Fashion.</strong> Identify specific brands and persons who wear them</li></ol><h3 name="65d0" id="65d0" class="graf graf--h3 graf-after--li">Data</h3><p name="a4d7" id="a4d7" class="graf graf--p graf-after--h3">I downloaded the images for testing from <a href="https://unsplash.com/search/photos/walking" data-href="https://unsplash.com/search/photos/walking" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank"><strong class="markup--strong markup--p-strong">here</strong></a>. Then I compressed the image to 300*200 size and used these images as test images for this project.</p><h3 name="19e1" id="19e1" class="graf graf--h3 graf-after--p">Non Maximum Suppression</h3><p name="b0a4" id="b0a4" class="graf graf--p graf-after--h3"><strong class="markup--strong markup--p-strong">History of Oriented Gradients(HOG)</strong> combined with <strong class="markup--strong markup--p-strong">Support Vector Machines(SVM)</strong> have been pretty successful for detecting objects in images but the problem with those algorithms is that they detect multiple bounding boxes surrounding the objects in the image. Hence they are not applicable in our case that is detecting pedestrians on crowded roads. Here’s where Non maximum suppression(NMS) comes to rescue to better refine the bounding boxes given by detectors. In this algorithm we propose additional penalties to produce more compact bounding boxes and thus become less sensitive to the threshold of NMS. The ideal solution for crowds under their pipelines with greedy NMS is to set a high threshold to preserve highly overlapped objects and predict very compact detection boxes for all instances to reduce false positives.</p><h3 name="6d54" id="6d54" class="graf graf--h3 graf-after--p">Environment and tools</h3><ol class="postList"><li name="3034" id="3034" class="graf graf--li graf-after--h3">scikit-learn</li><li name="4db7" id="4db7" class="graf graf--li graf-after--li">scikit-Image</li><li name="fd05" id="fd05" class="graf graf--li graf-after--li">numpy</li><li name="ba8c" id="ba8c" class="graf graf--li graf-after--li">opencv</li></ol><h3 name="e031" id="e031" class="graf graf--h3 graf-after--li">Where is the code?</h3><p name="47f7" id="47f7" class="graf graf--p graf-after--h3">Without much ado, let’s get started with the code. The complete project on github can be found <a href="https://github.com/abhinavsagar/Pedestrian-detection" data-href="https://github.com/abhinavsagar/Pedestrian-detection" class="markup--anchor markup--p-anchor" rel="noopener" target="_blank">here</a>.</p><p name="5a2d" id="5a2d" class="graf graf--p graf-after--p">I started by calculating the overlapping areas between two bounding boxes as detected by our algorithm.</p><figure name="80a8" id="80a8" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/abhinavsagar/bf1b5254cf15a013a727c315e7e7116c.js"></script></figure><figure name="8426" id="8426" class="graf graf--figure graf-after--figure"><img class="graf-image" data-image-id="1*e7XbLr7A6HF18dcv9EDqpQ.jpeg" data-width="600" data-height="450" src="https://cdn-images-1.medium.com/max/800/1*e7XbLr7A6HF18dcv9EDqpQ.jpeg"></figure><p name="532c" id="532c" class="graf graf--p graf-after--figure">Then I defined a function to take bounding box rectangle and threshold factor as input. Also I sorted all the bounding boxes in descending order of the bottom right corner co-ordinate values. After that I appended all those boxes which were not within a factor of 0.5 times of the overlapping area with another box.</p><figure name="39ae" id="39ae" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/abhinavsagar/4fcae2a68ef7328e5e04c5ff65634ff1.js"></script></figure><p name="f5d8" id="f5d8" class="graf graf--p graf-after--figure">Time to load all the required libraries.</p><figure name="22f6" id="22f6" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/abhinavsagar/c90e51b7e062f91dc12684a61263634d.js"></script></figure><p name="70a7" id="70a7" class="graf graf--p graf-after--figure">Then I created a function to append the four end co-ordinates of all the bounding boxes to an empty list.</p><figure name="92b6" id="92b6" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/abhinavsagar/5ceb70b76bb97b8d235524efea856825.js"></script></figure><p name="2266" id="2266" class="graf graf--p graf-after--figure">After that I created some parser arguments for image location, downscaling it, visualizing it and applying threshold to it.</p><figure name="fef9" id="fef9" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/abhinavsagar/6349d312fd33521dd26af6162c0811be.js"></script></figure><p name="f545" id="f545" class="graf graf--p graf-after--figure">Then comes the core part of the algorithm. I used a pickle file which was generated after training it over thousands of images both having pedestrians and not having pedestrians. Also I converted the image to greyscale and applied strides on it.</p><figure name="dcb8" id="dcb8" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/abhinavsagar/1c599b9a0cf1c98f7374ebba43416480.js"></script></figure><p name="e3e2" id="e3e2" class="graf graf--p graf-after--figure">After that I created a script to find and locate all the bounding boxes which were within a threshold as defined by the nms function as shown above. Please note the below script might look intimidating at first glance but it is just plain mathematics.</p><figure name="2c46" id="2c46" class="graf graf--figure graf--iframe graf-after--p"><script src="https://gist.github.com/abhinavsagar/ab0dfe2bda1f187d284dd78163df9f4d.js"></script></figure><p name="7368" id="7368" class="graf graf--p graf-after--figure">Finally, I wrote a bunch of lines to display both the images before and after NMS is applied and saved the output image which I got.</p><figure name="1a1d" id="1a1d" class="graf graf--figure graf--iframe graf-after--p graf--trailing"><script src="https://gist.github.com/abhinavsagar/a5ad3525fffcf49b3d81212f57163f16.js"></script></figure></div></div></section><section name="5237" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="82af" id="82af" class="graf graf--h3 graf--leading">Evaluating Pedestrian Detection Model</h3><p name="87ec" id="87ec" class="graf graf--p graf-after--h3">Every image in an object detection problem could have different objects of different classes. Hence the standard metric of precision used in image classification problems cannot be directly applied here. This is where mAP(Mean Average-Precision) comes into the picture.</p><h3 name="a8e5" id="a8e5" class="graf graf--h3 graf-after--p">Ground Truth</h3><p name="5723" id="5723" class="graf graf--p graf-after--h3">For any algorithm, the metrics are always evaluated in comparison to the ground truth data. We only know the Ground Truth information for the Training, Validation and Test datasets.</p><p name="a214" id="a214" class="graf graf--p graf-after--p">For object detection problems, the ground truth includes the image, the classes of the objects in it and the true bounding boxes of each of the objects in that image.</p><figure name="6800" id="6800" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*1t2m59fAnY2bDqod9_f7HQ.png" data-width="640" data-height="424" src="https://cdn-images-1.medium.com/max/800/1*1t2m59fAnY2bDqod9_f7HQ.png"><figcaption class="imageCaption">Sample Example</figcaption></figure><h3 name="fbba" id="fbba" class="graf graf--h3 graf-after--figure">Calculating the mAP</h3><p name="fa1e" id="fa1e" class="graf graf--p graf-after--h3">Let’s say the original image and ground truth annotations are as we have seen above. The training and validation data has all images annotated in the same way. The model would return lots of predictions but out of those most of them would have a very low confidence score associated hence we only consider predictions above a certain reported confidence score. We run the original image through our model and this is what the object detection algorithm returns after confidence thresholding.</p><p name="15d5" id="15d5" class="graf graf--p graf-after--p">We first need to know to judge the correctness of each of these detections. The metric that tells us the correctness of a given bounding box is the — IoU — Intersection over Union.</p><h3 name="4a1c" id="4a1c" class="graf graf--h3 graf-after--p">Calculating the IOU</h3><p name="6404" id="6404" class="graf graf--p graf-after--h3">Intersection over Union is a ratio between the intersection and the union of the predicted boxes and the ground truth boxes.</p><figure name="9f71" id="9f71" class="graf graf--figure graf-after--p"><img class="graf-image" data-image-id="1*E3TxnfVIPpoRWtWJnKbO1g.png" data-width="422" data-height="391" src="https://cdn-images-1.medium.com/max/800/1*E3TxnfVIPpoRWtWJnKbO1g.png"></figure><h3 name="6032" id="6032" class="graf graf--h3 graf-after--figure">Results</h3><figure name="069a" id="069a" class="graf graf--figure graf-after--h3"><img class="graf-image" data-image-id="1*BkyqPyx5YAPw-iFSD5S1JA.jpeg" data-width="301" data-height="167" src="https://cdn-images-1.medium.com/max/800/1*BkyqPyx5YAPw-iFSD5S1JA.jpeg"><figcaption class="imageCaption">Input Image</figcaption></figure><figure name="de1b" id="de1b" class="graf graf--figure graf-after--figure graf--trailing"><img class="graf-image" data-image-id="1*0PKKZGGCJkARMKBlVH9y-w.jpeg" data-width="301" data-height="167" src="https://cdn-images-1.medium.com/max/800/1*0PKKZGGCJkARMKBlVH9y-w.jpeg"><figcaption class="imageCaption">Output Image</figcaption></figure></div></div></section><section name="827a" class="section section--body"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="d626" id="d626" class="graf graf--h3 graf--leading">Conclusions</h3><p name="ea94" id="ea94" class="graf graf--p graf-after--h3 graf--trailing">Although algorithms like <strong class="markup--strong markup--p-strong">Mask R-CNN</strong> have pushed the boundaries and are considered the state of art instance segmentation algorithms, but still problems like pedestrian detection pose a lot of open challenges. Non Maximum Suppression algorithms still fails if the images contains a lot of people clustered in one location. This project is far from over. In fact it has opened more questions than it has answered. The future of self driving cars relies a lot on efficient pedestrian detection algorithms.</p></div></div></section><section name="f5e3" class="section section--body section--last"><div class="section-divider"><hr class="section-divider"></div><div class="section-content"><div class="section-inner sectionLayout--insetColumn"><h3 name="29ed" id="29ed" class="graf graf--h3 graf--leading">References/Further Readings</h3><div name="cae1" id="cae1" class="graf graf--mixtapeEmbed graf-after--h3"><a href="https://medium.com/@abhinav.sagar/pedestrian-tracking-in-real-time-using-yolov3-33439125efdf" data-href="https://medium.com/@abhinav.sagar/pedestrian-tracking-in-real-time-using-yolov3-33439125efdf" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://medium.com/@abhinav.sagar/pedestrian-tracking-in-real-time-using-yolov3-33439125efdf"><strong class="markup--strong markup--mixtapeEmbed-strong">Pedestrian Tracking in Real Time Using YOLOv3</strong><br><em class="markup--em markup--mixtapeEmbed-em">A complete pipeline for tracking pedestrians.</em>medium.com</a><a href="https://medium.com/@abhinav.sagar/pedestrian-tracking-in-real-time-using-yolov3-33439125efdf" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="44a29d6ab88840a995deb778109abaf3" data-thumbnail-img-id="1*vXEfgsP0pzxvJ-MQUhvSYQ.jpeg" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/1*vXEfgsP0pzxvJ-MQUhvSYQ.jpeg);"></a></div><div name="442f" id="442f" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="http://arxiv.org/abs/1904.03629" data-href="http://arxiv.org/abs/1904.03629" class="markup--anchor markup--mixtapeEmbed-anchor" title="http://arxiv.org/abs/1904.03629"><strong class="markup--strong markup--mixtapeEmbed-strong">Adaptive NMS: Refining Pedestrian Detection in a Crowd</strong><br><em class="markup--em markup--mixtapeEmbed-em">Pedestrian detection in a crowd is a very challenging issue. This paper addresses this problem by a novel Non-Maximum…</em>arxiv.org</a><a href="http://arxiv.org/abs/1904.03629" class="js-mixtapeImage mixtapeImage mixtapeImage--empty u-ignoreBlock" data-media-id="eb4eb1dea0f50a898074243bc7644c2f"></a></div><div name="6217" id="6217" class="graf graf--mixtapeEmbed graf-after--mixtapeEmbed"><a href="https://www.pyimagesearch.com/2014/11/17/non-maximum-suppression-object-detection-python/" data-href="https://www.pyimagesearch.com/2014/11/17/non-maximum-suppression-object-detection-python/" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://www.pyimagesearch.com/2014/11/17/non-maximum-suppression-object-detection-python/"><strong class="markup--strong markup--mixtapeEmbed-strong">Non-Maximum Suppression for Object Detection in Python - PyImageSearch</strong><br><em class="markup--em markup--mixtapeEmbed-em">Connecticut is cold. Very cold. Sometimes it&#39;s hard to even get out of bed in the morning. And honestly, without the…</em>www.pyimagesearch.com</a><a href="https://www.pyimagesearch.com/2014/11/17/non-maximum-suppression-object-detection-python/" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="99efc627894f4ed3d040cd92caa306e8" data-thumbnail-img-id="0*Jy4PJ8i5JAMZgO48" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*Jy4PJ8i5JAMZgO48);"></a></div><h3 name="2e3a" id="2e3a" class="graf graf--h3 graf-after--mixtapeEmbed">Before You Go</h3><p name="e7d9" id="e7d9" class="graf graf--p graf-after--h3">The corresponding source code can be found here.</p><div name="c2df" id="c2df" class="graf graf--mixtapeEmbed graf-after--p"><a href="https://github.com/abhinavsagar/Pedestrian-detection" data-href="https://github.com/abhinavsagar/Pedestrian-detection" class="markup--anchor markup--mixtapeEmbed-anchor" title="https://github.com/abhinavsagar/Pedestrian-detection"><strong class="markup--strong markup--mixtapeEmbed-strong">abhinavsagar/Pedestrian-detection</strong><br><em class="markup--em markup--mixtapeEmbed-em">Pedestrian detection using Non Maximum Suppression. Pedestrian detection is still an unsolved problem in computer…</em>github.com</a><a href="https://github.com/abhinavsagar/Pedestrian-detection" class="js-mixtapeImage mixtapeImage u-ignoreBlock" data-media-id="291cdb52e65d80d37bedff755c4ee615" data-thumbnail-img-id="0*UV1VqEjx0fZipV95" style="background-image: url(https://cdn-images-1.medium.com/fit/c/160/160/0*UV1VqEjx0fZipV95);"></a></div><h3 name="3934" id="3934" class="graf graf--h3 graf-after--mixtapeEmbed">Contacts</h3><p name="924e" id="924e" class="graf graf--p graf-after--h3">If you want to keep updated with my latest articles and projects <a href="https://medium.com/@abhinav.sagar" data-href="https://medium.com/@abhinav.sagar" class="markup--anchor markup--p-anchor" target="_blank">follow me on Medium</a>. These are some of my contacts details:</p><ul class="postList"><li name="4fcf" id="4fcf" class="graf graf--li graf-after--p"><a href="https://abhinavsagar.github.io" data-href="https://abhinavsagar.github.io" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Personal Website</a></li><li name="575a" id="575a" class="graf graf--li graf-after--li"><a href="https://in.linkedin.com/in/abhinavsagar4" data-href="https://in.linkedin.com/in/abhinavsagar4" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Linkedin</a></li><li name="6139" id="6139" class="graf graf--li graf-after--li"><a href="https://medium.com/@abhinav.sagar" data-href="https://medium.com/@abhinav.sagar" class="markup--anchor markup--li-anchor" target="_blank">Medium Profile</a></li><li name="2e6d" id="2e6d" class="graf graf--li graf-after--li"><a href="https://github.com/abhinavsagar" data-href="https://github.com/abhinavsagar" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">GitHub</a></li><li name="de97" id="de97" class="graf graf--li graf-after--li"><a href="https://www.kaggle.com/abhinavsagar" data-href="https://www.kaggle.com/abhinavsagar" class="markup--anchor markup--li-anchor" rel="noopener" target="_blank">Kaggle</a></li></ul><p name="dc11" id="dc11" class="graf graf--p graf-after--li graf--trailing">Happy reading, happy learning and happy coding.</p></div></div></section>
</section>
<footer><p>By <a href="https://medium.com/@abhinav.sagar" class="p-author h-card">Abhinav Sagar</a> on <a href="https://medium.com/p/b55b89cefc6"><time class="dt-published" datetime="2019-06-01T11:52:29.652Z">June 1, 2019</time></a>.</p><p><a href="https://medium.com/@abhinav.sagar/pedestrian-detection-using-non-maximum-suppression-b55b89cefc6" class="p-canonical">Canonical link</a></p><p>Exported from <a href="https://medium.com">Medium</a> on April 28, 2021.</p></footer></article></body></html>